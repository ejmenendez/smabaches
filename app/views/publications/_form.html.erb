<script src="//maps.google.com/maps/api/js?v=3.23&sensor=false&client=&key=&libraries=geometry&language=&hl=&region="></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script>

<script>
	$(document).ready(function()
	{
		getLocation();
	});

	// usePosition es llamada desde getLocation.js
	function usePosition(position) {
		document.getElementById("latitud").value = position.coords.latitude.toString();
		document.getElementById("longitud").value = position.coords.longitude.toString();
	}
</script>


<%= form_for @publication do |form| %>

	<p>
		<%= form.label :title %><br>
		<%= form.text_field :title %>
	</p>

	<p>
        	<%= form.label :decription %><br>
        	<%= form.text_area :description %>
	</p>


	<%= form.label :photo %><br>
    <%= form.file_field :photo %>

	<!-- Latitud y longitud las saco del browser y van en campos ocultos. -->
	<p>
        	<%= form.hidden_field :latitude, :id=>"latitud", :class => 'text_field', :step => 'any' %>
	</p>

	<p>
        	<%= form.hidden_field :longitude, :id=>"longitud", :class => 'text_field', :step => 'any' %>
	</p>

	<p>
        	<%= form.hidden_field :published, :id=>"publicado", :class => 'checkbox', :value => 'false' %>
	</p>
	<div style='width: 500px;'>
	  <div id="map" style='width: 500px; height: 250px;'></div>
	</div>

	<script>
		handler = Gmaps.build('Google');
		handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
			handler.fitMapToBounds();
			handler.map.centerOn([-40.1552557,-71.3472031])
			handler.getMap().setZoom(14);
		});

		google.maps.event.addListener(handler.getMap(),'click',function(event){
			$("#latitud").val(event.latLng.lat());
			$("#longitud").val(event.latLng.lng());
			addMarker(event.latLng);
		});

		function addMarker(location){
			var marker = new google.maps.Marker({
				position: location,
				map: handler.getMap()
			});
			markers.push(marker);
		}


	</script>

	<p>
		<%= form.submit %>
	</p>

<% end %>
